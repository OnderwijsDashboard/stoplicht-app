<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Stoplicht - leerling</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:Arial,Helvetica,sans-serif;padding:20px;max-width:720px;margin:auto}
.buttons button{display:block;width:100%;padding:14px;margin:8px 0;font-size:18px;border:none;border-radius:8px;color:white;cursor:pointer}
.aanhetwerk{background:#5cb85c} /* groen */
.vraag{background:#d9534f}       /* rood */
.status-list{margin-top:18px;padding:0;list-style:none;display:flex;flex-wrap:wrap;gap:8px}
.status-item{display:flex;align-items:center;padding:8px 10px;border-radius:8px;background:#f7f7f7;min-width:180px}
.dot{width:16px;height:16px;border-radius:50%;margin-right:10px;flex:0 0 16px}
#msg{margin-top:12px}
</style>
</head>
<body>
<h2>Stoplicht - leerling</h2>

<label for="studentName">Kies je naam</label>
<select id="studentName" aria-label="Student naam">
    <option value="">-- Kies je naam --</option>
</select>

<div class="buttons" role="group" aria-label="Stoplicht knoppen">
    <button class="aanhetwerk" data-status="aanhetwerk">ðŸŸ© Aan het werk / Geen vragen</button>
    <button class="vraag" data-status="vraag">ðŸŸ¥ Ik heb een vraag</button>
</div>

<p id="msg" style="color:green" aria-live="polite"></p>

<h3>Huidige status klas</h3>
<ul id="statusList" class="status-list" aria-live="polite"></ul>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC8wWU5VUq6YLNzxBObFuVN8WYegKzZTPI",
  authDomain: "stoplichtblokje.firebaseapp.com",
  databaseURL: "https://stoplichtblokje-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "stoplichtblokje",
  storageBucket: "stoplichtblokje.firebasestorage.app",
  messagingSenderId: "1019644227104",
  appId: "1:1019644227104:web:833b07ad778a8df5171645",
  measurementId: "G-3MG6YRBVD2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const sel = document.getElementById('studentName');
const statusList = document.getElementById('statusList');

// Haal studentenlijst uit Firebase en vul dropdown
function loadStudents(){
    db.ref('students').on('value', snapshot=>{
        const data = snapshot.val() || {};
        const curVal = sel.value;
        sel.innerHTML = '<option value="">-- Kies je naam --</option>';
        Object.keys(data).forEach(k=>{
            const opt = document.createElement('option');
            opt.value = k;
            opt.textContent = data[k].name;
            sel.appendChild(opt);
        });
        if(curVal && sel.querySelector('option[value="'+curVal+'"]')) sel.value = curVal;
    });
}

// Update status
function updateStatus(id,name,status){
    // Als status 'vraag', sla ook een volgnummer op om eerste bovenaan te tonen
    const updates = {status: status};
    if(status==='vraag'){
        updates.vraagTijd = Date.now();
    } else {
        updates.vraagTijd = null;
    }
    db.ref('students/'+id).update({...updates,name:name});
    const msg = document.getElementById('msg');
    msg.textContent = 'Status opgeslagen: '+status;
    msg.style.color='green';
    setTimeout(()=>{ msg.textContent=''; },2000);
}

// Buttons
document.querySelectorAll('.buttons button').forEach(b=>{
    b.addEventListener('click', ()=>{
        if(!sel.value) return;
        const id = sel.value;
        const name = sel.options[sel.selectedIndex].text;
        const status = b.dataset.status;
        updateStatus(id,name,status);
    });
});

// Render klasstatussen
function renderStatuses(snapshot){
    const data = snapshot.val() || {};
    const items = Object.keys(data).map(k=>{
        return {id:k, name:data[k].name, status:data[k].status||'aanhetwerk', vraagTijd:data[k].vraagTijd||null};
    });

    // Sorteer: eerst 'vraag', op volgorde van eerste klik (vraagTijd laagste bovenaan)
    items.sort((a,b)=>{
        if(a.status==='vraag' && b.status!=='vraag') return -1;
        if(a.status!=='vraag' && b.status==='vraag') return 1;
        if(a.status==='vraag' && b.status==='vraag'){
            return (a.vraagTijd||0) - (b.vraagTijd||0);
        }
        return 0;
    });

    statusList.innerHTML='';
    items.forEach(it=>{
        const li = document.createElement('li');
        li.className='status-item';
        const dot = document.createElement('div');
        dot.className='dot';
        if(it.status==='aanhetwerk') dot.style.background='#5cb85c';
        else if(it.status==='vraag') dot.style.background='#d9534f';
        else dot.style.background='#bbb';
        const name = document.createElement('div');
        name.textContent=it.name;
        li.appendChild(dot);
        li.appendChild(name);
        statusList.appendChild(li);
    });
}

// Start realtime listener
db.ref('students').on('value', renderStatuses);
loadStudents();
</script>
</body>
</html>
